# 使用 Dune

## 一、ethereum.transactions

### 1. **统计地址之间的 ETH 转账总金额**

```sql
## 7 天内发出 ETH 的地址的数量排名
SELECT
  "from" AS address,
  SUM("value") / 1e18 AS total_sent_eth,
  COUNT(*) AS tx_count
FROM
  ethereum.transactions
WHERE
  block_time >= CURRENT_DATE - INTERVAL '7' DAY
  AND value > 0
GROUP BY
  "from"
ORDER BY
  total_sent_eth DESC
LIMIT 100;
```

### 2. **识别某个地址在一段时间内的所有转账（收款和付款）**



### 3. **找出 ETH 转账金额最大的一笔交易**



### 4. **分析某个地址的净转账额（收款 - 支出）**

```sql
select sum(transfer_in) as sum_transfer_in, sum(transfer_out) sum_transfer_out, sum(transfer_in) - sum(transfer_out) as delta
from (select *, 
      (case when "to" = 0x974CaA59e49682CdA0AD2bbe82983419A2ECC400 then "value" / 1e18
            else 0 end
      ) as transfer_in, 
      (case when "from" = 0x974CaA59e49682CdA0AD2bbe82983419A2ECC400 then "value" / 1e18
            else 0 end
      ) as transfer_out
      from ethereum.transactions
      where block_time >= CURRENT_DATE - INTERVAL '30' DAY
        and ( "from" = 0x974CaA59e49682CdA0AD2bbe82983419A2ECC400
              or "to" = 0x974CaA59e49682CdA0AD2bbe82983419A2ECC400)
        and "value" > 0
     )
```

### 5. **识别地址之间的双向转账关系（可能是交易对手或 CEX 热钱包）**

- 条件：A 转给 B，同时 B 又转给 A

## 二、ethereum.logs

### 1、ERC20/ERC721/ERC1155 类事件分析

#### 1、查询某个代币的前 10 个发送地址（按转账金额降序）

```sql
select * from (
    select
        "topic1"
        , sum(bytearray_to_uint256("data")) as total_amount
    from ethereum.logs
    where block_time >= CURRENT_DATE - INTERVAL '30' DAY
       and "contract_address" = 0xdac17f958d2ee523a2206206994597c13d831ec7
       and "topic0" = 0xddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef
    group by
        "topic1"
) order by total_amount desc
```

#### 2、查询某个地址收到最多转账的某个ERC20 代币（按金额排序）

```sql
select * from (
  select
    "topic2"
    , sum(bytearray_to_uint256 ("data")) / 1e6 as total_amount
  from ethereum.logs
  where block_time >= CURRENT_DATE - INTERVAL '60' DAY
  and "contract_address" = 0xdAC17F958D2ee523a2206206994597C13D831ec7
  and "topic0" = 0xddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef
  and "topic3" is null
  group by "topic2"
)order by total_amount desc
```

#### 3、追踪某个 NFT 合约中交易最活跃的地址（按交易次数）

#### 4、分析某个 NFT 合约的 mint 活动（from 为 0x0 的 Transfer 事件）
